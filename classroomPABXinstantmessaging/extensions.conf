[general]
; Recibe lo que no tiene un contexto propio definido.
exten => _X.,1,Hangup(21)
exten => s,1,Hangup(21)
; El codigo 21 especifica prohibicion.

#[linea]
#; Llamadas entrantes desde la PSTN. Entran en la extensión 101.
#exten => s,1,Dial(SIP/101)
#same => n,Hangup(16)
#; El codigo 16 indica llamada terminada con normalidad.

[extensiones]
; internas
exten => _[1-2]XX,1,Dial(SIP/${EXTEN}) 
same => n,Hangup()
#; Llamadas a fijos de Espana salientes a la PSTN.
#exten => _[8-9][1-8]XXXXXXX,1,Dial(SIP/0034${EXTEN}@lineawololot)
#same => n,Hangup(16)
#; Llamadas a moviles de Espana salientes a la PSTN.
#exten => _[6-7]XXXXXXXX,1,Dial(SIP/0034${EXTEN}@lineawololot)
#same => n,Hangup(16)



[messages]
exten => _.,1,NoOp(SMS receiving dialplan invoked)
exten => _.,n,NoOp(To ${MESSAGE(to)})
exten => _.,n,NoOp(From ${MESSAGE(from)})
exten => _.,n,NoOp(Body ${MESSAGE(body)})
;exten => _.,n,AGI(chatplan.php,${MESSAGE(from)})
exten => _.,n,Set(ACTUALTO=${CUT(MESSAGE(to),@,1)})
exten => _.,n,ExecIf($["${ACTUALTO}" != "sip:${EXTEN}"]?Set(ACTUALTO=sip:${EXTEN}))
exten => _.,n,MessageSend(${ACTUALTO},${MESSAGE(from)})
exten => _.,n,NoOp(Send status is ${MESSAGE_SEND_STATUS})
exten => _.,n,GotoIf($["${MESSAGE_SEND_STATUS}" != "SUCCESS"]?sendfailedmsg)
exten => _.,n,Hangup()
;; Handle failed messaging
exten => _.,n(sendfailedmsg),NoOp(Sending error to user)
exten => _.,n,Set(SRC=${MESSAGE(from)})
exten => _.,n,Set(DST=${MESSAGE(to)})
exten => _.,n,Set(MSG=${MESSAGE(body)})
exten => _.,n,Set(MESSAGE(body)="[${STRFTIME(${EPOCH},,%d%m%Y-%H:%M:%S)}] Sua mensagem para ${EXTEN} falhou. Destinatário não está on-line")
exten => _.,n,Set(ME_1=${CUT(MESSAGE(from),<,2)})
exten => _.,n,Set(ACTUALFROM=${CUT(ME_1,@,1)})
exten => _.,n,MessageSend(${ACTUALFROM},ServiceCenter)
;exten => _.,n,GotoIf($["${INQUEUE}" != "1"]?startq)
exten => _.,n,Hangup()
